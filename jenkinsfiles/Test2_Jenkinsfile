node {
   //triggers { pollSCM('* * * * *') }
   def mvnHome
   stage('Preparation') {
      git 'https://github.com/KosDP1987/spring-petclinic.git'
      mvnHome = tool '3'
   }
   stage('Build') {
      // Run the maven build
     def mvnCMD = "${mvnHome}/bin/mvn"
      sh "${mvnCMD} clean install -q"

        //sh '"$MVN_HOME/bin/mvn" -Dmaven.test.failure.ignore clean package'
        //sh '"$MVN_HOME/bin/mvn" -Dmaven.test.failure.ignore clean install -q'
   }
   stage('Results') {
      junit '**/target/surefire-reports/TEST-*.xml'
      archiveArtifacts 'target/*.jar'
   }
    stage ('Docker build')  {
           def dockerfile = 'Dockerfile'
   		sh 'docker build -t image:v1 .'
    }
    stage ('RUN Container')  {
        
	    sh 'docker run -ti -d -p 8088:8080 image:v1 java -jar spring-petclinic-2.1.0.BUILD-SNAPSHOT.jar'
  }

}
